{% extends 'base.html' %}

{% block title %}Review Order | WoodCraft{% endblock %}

{% block content %}
<section class="section">
    <div class="section-header">
        <h2>Review Your Order</h2>
    </div>

    <div class="checkout-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 60px;">
        <!-- Left: Details -->
        <div class="checkout-details">
            <div style="background: white; border: 1px solid #EBEBEB; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
                <h3 style="font-size: 18px; margin-bottom: 16px;">Shipping Information</h3>
                <p style="color: var(--text-secondary); line-height: 1.6;">
                    <strong>{{ order.user.first_name }} {{ order.user.last_name }}</strong><br>
                    {{ order.shipping_address.line1 }}<br>
                    {{ order.shipping_address.city }}, {{ order.shipping_address.state }} {{ order.shipping_address.zip_code }}<br>
                    {{ order.user.mobile_number }}
                </p>
                <a href="/checkout" style="color: var(--text-primary); text-decoration: underline; font-size: 13px; margin-top: 12px; display: inline-block;">Change</a>
            </div>

            <div style="background: white; border: 1px solid #EBEBEB; border-radius: 8px; overflow: hidden;">
                <div style="padding: 24px; border-bottom: 1px solid #EBEBEB; font-weight: 500;">Items</div>
                {% for item in order.items.all %}
                <div style="display: flex; gap: 24px; padding: 24px; border-bottom: 1px solid #F9F9F9;">
                    <div style="width: 80px; height: 80px; background: #F4F4F4; border-radius: 4px;">
                        <!-- Img placeholder -->
                    </div>
                    <div style="flex-grow: 1;">
                        <div style="font-weight: 500; margin-bottom: 4px;">{{ item.product_snapshot.name }}</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">Qty: {{ item.quantity }}</div>
                    </div>
                    <div style="font-weight: 500;">₹{{ item.unit_price }}</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Right: Payment -->
        <div class="order-summary" style="background: #FAF9F6; padding: 32px; border-radius: 4px; height: fit-content; border: 1px solid #EBE0D0;">
            <h3 style="margin-bottom: 24px;">Payment Summary</h3>
            
            <div style="margin-bottom: 16px; display: flex; justify-content: space-between; color: var(--text-secondary);">
                <span>Subtotal</span>
                <span>₹{{ order.total_amount }}</span>
            </div>
            <div style="margin-bottom: 16px; display: flex; justify-content: space-between; color: var(--text-secondary);">
                <span>Shipping</span>
                <span>Free</span>
            </div>
            <div style="margin-bottom: 16px; display: flex; justify-content: space-between; color: var(--text-secondary);">
                <span>Tax (GST)</span>
                <span>Included</span>
            </div>

            <div style="border-top: 1px solid #DCD0C0; padding-top: 24px; margin-top: 24px; display: flex; justify-content: space-between; font-weight: 600; font-size: 20px;">
                <span>Total</span>
                <span>₹{{ order.total_amount }}</span>
            </div>
            
            <div style="margin-top: 32px;">
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px; text-align: center;">
                    By clicking below, you will be redirected to our secure payment gateway.
                </p>
                <button id="payBtn" class="btn btn-primary" style="width: 100%; padding: 18px; font-size: 16px;">Proceed to Pay</button>
            </div>
        </div>
    </div>
</section>

<script>
    document.getElementById('payBtn').addEventListener('click', () => {
        // Mock Payment Success
        const btn = document.getElementById('payBtn');
        btn.innerHTML = 'Processing...';
        btn.disabled = true;
        
        setTimeout(() => {
            window.location.href = "/checkout/success/?order_id={{ order.id }}";
        }, 1500);
    });
</script>
{% endblock %}
