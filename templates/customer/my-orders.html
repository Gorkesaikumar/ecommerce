{% extends 'base.html' %}

{% block title %}My Orders | WoodCraft{% endblock %}

{% block content %}
<section class="section">
    <div class="dashboard-layout">
        {% include 'customer/sidebar.html' %}

        <main>
            <style>
                .dashboard-layout {
                    display: grid;
                    grid-template-columns: 280px 1fr;
                    gap: 40px;
                    align-items: start;
                }
                @media (max-width: 1024px) {
                    .dashboard-layout {
                        grid-template-columns: 1fr;
                        gap: 24px;
                    }
                    aside {
                        display: none; 
                    }
                }

                .order-header {
                    padding: 16px 24px; 
                    background: #fcfcfc; 
                    border-bottom: 1px solid #eee; 
                    display: flex; 
                    justify-content: space-between; 
                    align-items: center;
                }
                .order-footer {
                    display: flex; 
                    justify-content: space-between; 
                    align-items: center; 
                    padding-top: 16px; 
                    border-top: 1px solid #f9f9f9;
                }
                @media (max-width: 768px) {
                    .order-header, .order-footer {
                        flex-direction: column;
                        align-items: flex-start;
                        gap: 12px;
                    }
                    .order-footer a {
                        width: 100%;
                        text-align: center;
                    }
                }
            </style>
            
            <div style="margin-bottom: 24px;">
                <h2 style="font-family: var(--font-heading);">My Orders</h2>
            </div>

            {% if orders %}
                <div style="display: flex; flex-direction: column; gap: 24px;">
                    {% for order in orders %}
                    <div style="border: 1px solid #eee; border-radius: 8px; background: white; overflow: hidden; transition: box-shadow 0.2s;">
                        <div class="order-header">
                            <div>
                                <span style="font-weight: 600; margin-right: 12px;">Order #{{ order.id }}</span>
                                <span style="color: var(--text-secondary); font-size: 13px;">{{ order.created_at|date:"F d, Y" }}</span>
                            </div>
                            <span class="badge {% if order.status == 'DELIVERED' %}badge-success{% elif order.status == 'CANCELLED' %}badge-danger{% else %}badge-neutral{% endif %}">{{ order.get_status_display }}</span>
                        </div>
                        
                        <div style="padding: 24px;">
                            <!-- Items Preview (First 2) -->
                            <div style="margin-bottom: 20px;">
                                {% for item in order.items.all|slice:":2" %}
                                <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                                    <div style="width: 48px; height: 48px; background: #fff; border-radius: 4px; overflow: hidden; border: 1px solid #eee;">
                                        {% if item.product.image_urls %}
                                        <img src="{{ item.product.image_urls.0 }}" style="width: 100%; height: 100%; object-fit: contain;">
                                        {% else %}
                                        <div style="width: 100%; height: 100%; background: #f4f4f4;"></div>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <div style="font-weight: 500; font-size: 14px;">{{ item.product_snapshot.name }}</div>
                                        <div style="font-size: 13px; color: var(--text-secondary);">Qty: {{ item.quantity }}</div>
                                    </div>
                                </div>
                                {% endfor %}
                                
                                {% if order.items.count > 2 %}
                                <div style="font-size: 13px; color: var(--text-secondary); margin-left: 64px;">
                                    + {{ order.items.count|add:"-2" }} more items
                                </div>
                                {% endif %}
                            </div>

                            <div class="order-footer">
                                <div>
                                    <span style="color: var(--text-secondary); font-size: 13px;">Total Amount</span>
                                    <div style="font-weight: 600; font-size: 16px;">â‚¹{{ order.total_amount }}</div>
                                </div>
                                <a href="{% url 'order-detail-frontend' order.id %}" class="btn btn-secondary" style="font-size: 14px;">View Details</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="text-align: center; padding: 60px; border: 1px solid #eee; border-radius: 8px; background: white;">
                    <div style="font-size: 48px; margin-bottom: 16px;">ðŸ“¦</div>
                    <h3 style="margin-bottom: 8px;">No orders yet</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">Browse our collection and find something unique for your home.</p>
                    <a href="/products/" class="btn btn-primary">Start Shopping</a>
                </div>
            {% endif %}
        </main>
    </div>
</section>
{% endblock %}
