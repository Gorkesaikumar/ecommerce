{% extends 'base.html' %}

{% block title %}Shop Collection | WoodCraft{% endblock %}

{% block extra_css %}
<style>
    /* Responsive Product Grid */
    .product-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 24px;
        margin-top: 32px;
    }
    
    .filters-bar {
        display: flex;
        gap: 12px;
        overflow-x: auto;
        padding-bottom: 8px; /* For scrollbar space */
        scrollbar-width: none; /* Hide scrollbar Firefox */
    }
    .filters-bar::-webkit-scrollbar { display: none; } /* Hide Chrome */

    /* Tablet */
    @media (max-width: 1024px) {
        .product-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
    }

    /* Mobile */
    @media (max-width: 768px) {
        .product-grid {
            grid-template-columns: repeat(1, 1fr); /* 2 columns is also popular, but 1 allows bigger images */
            gap: 16px;
        }
        
        /* Optional: 2 col on mobile if desired, let's stick to 1 for "premium" feel or 2 for density.
           Let's go 1 column for full width impact as per "premium" requested spec usually. 
           Actually, widely used e-com pattern is 2 cols on mobile. Let's do 2 cols for standard, 1 for very small?
           Let's stick to a robust 1-column layout for now to avoid squishing, or 2 cols with care.
           Let's try 2 columns for better browsing efficiency on mobile.
        */
        .product-grid {
            grid-template-columns: repeat(2, 1fr); 
        }
    }
    
    @media (max-width: 480px) {
         .product-grid {
            grid-template-columns: repeat(1, 1fr); /* 1 Column on very small screens */
        }
    }
    
    /* Image Optimization */
    .product-image {
        position: relative;
        width: 100%;
        aspect-ratio: 4/5; /* Standard portrait ratio */
        background: #fcfcfc;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* Prevents cropping */
        transition: transform 0.4s ease;
        padding: 8px; /* Breathing room */
    }
    
    .product-card:hover .product-image img {
        transform: scale(1.08);
    }
</style>
{% endblock %}

{% block content %}
<section class="section">
    <div class="section-header">
        <h2>Shop Collection</h2>
    </div>

    <!-- Category Filters -->
    <div class="filters-bar">
        <a href="{% url 'product-list-frontend' %}" class="filter-pill {% if not request.GET.category %}active{% endif %}">All</a>
        {% for cat in categories %}
        {% if cat.slug %}
        <a href="?category={{ cat.slug }}" class="filter-pill {% if request.GET.category == cat.slug %}active{% endif %}">
            {{ cat.name }}
        </a>
        {% endif %}
        {% endfor %}
    </div>

    <div class="product-grid">
        {% for product in products %}
        <a href="{% url 'product-detail-slug-frontend' product.slug|default:product.id %}" class="product-card" style="position: relative;">
            <div class="product-image">
                {% if product.image_urls %}
                <img src="{{ product.image_urls.0 }}" alt="{{ product.name }}" style="{{ product.stock_quantity|yesno:',opacity: 0.6;' }}">
                {% else %}
                <img src="/static/img/product1.jpg" alt="Product" style="{{ product.stock_quantity|yesno:',opacity: 0.6;' }}">
                {% endif %}
                
                {% if product.stock_quantity == 0 %}
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 8px 16px; border-radius: 4px; font-size: 14px; font-weight: 600;">
                    Out of Stock
                </div>
                {% elif product.stock_quantity <= 100 %}
                <div style="position: absolute; top: 10px; left: 10px; background: #ef6c00; color: white; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; z-index: 2;">
                    Only {{ product.stock_quantity }} Left
                </div>
                {% endif %}
            </div>
            <div class="product-name">{{ product.name }}</div>
            <div class="product-price-row">
                <div class="price">â‚¹{{ product.base_price }}</div>
                {% if product.stock_quantity > 0 %}
                <button class="btn-add-mini" title="Add to Cart" data-product-id="{{ product.id }}">+</button>
                {% else %}
                <button class="btn-add-mini" style="background: #ccc; cursor: not-allowed;" disabled title="Out of Stock">x</button>
                {% endif %}
            </div>
        </a>
        {% empty %}
        <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: var(--text-secondary);">
            <p>No products found in this category.</p>
            <a href="{% url 'product-list-frontend' %}" class="btn btn-secondary" style="margin-top: 20px; display: inline-block;">Clear Filters</a>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="pagination" style="text-align: center; margin-top: 60px;">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}&category={{ request.GET.category }}" class="btn btn-secondary">Previous</a>
            {% endif %}

            <span class="current" style="margin: 0 16px;">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}&category={{ request.GET.category }}" class="btn btn-secondary">Next</a>
            {% endif %}
        </span>
    </div>
    {% endif %}
</section>
{% endblock %}
